<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/fullcalendar-calendar/fullcalendar-theme.html">
<link rel="import" href="../bower_components/fullcalendar-calendar/fullcalendar-calendar.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/scale-down-animation.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<dom-module id="time-travel-calendar">
    <template>
        <style include="iron-flex">
        :host {
        display: block;
        padding: 10px;
        }
        .card {
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        padding: 16px;
        margin: 0 24px 24px 24px;
        border-radius: 5px;
        background-color: #fff;
        color: #757575;
        }
        .circle {
        display: inline-block;
        height: 64px;
        width: 64px;
        border-radius: 50%;
        background: #ddd;
        line-height: 64px;
        font-size: 30px;
        color: #555;
        text-align: center;
        }
        h1.title {
        font-size: 22px;
        font-weight: 100;
        margin: 0 0 16px 0;
        color: #212121;
        }

        iron-icon,
        [icon] {
          color: rgba(0, 0, 0, 0.6);
        }

        .dropdown-content iron-icon {
          padding-right: 15px;
        }

        paper-menu-button {
          padding: 0;
        }

        .actions {
          margin: 0 24px 0 11px;
        }

        --fullcalendar {

        }
        </style>

        <iron-ajax auto
                   url="pca.json"
                   method="GET"
                   handle-as="json"
                   on-response="aquirePCA"></iron-ajax>

        <iron-ajax auto
                   url="hours.json"
                   method="GET"
                   handle-as="json"
                   on-response="aquireHours"></iron-ajax>

        <div class="actions layout horizontal">
            <h1 class="title flex">
                <paper-icon-button id="previous" icon="chevron-left" on-transitionend="previous"></paper-icon-button>

                [[ title ]]

                <paper-icon-button id="next" icon="chevron-right" on-transitionend="next"></paper-icon-button>
            </h1>

            <paper-icon-button icon="search"></paper-icon-button>

            <paper-menu-button>
                <paper-icon-button icon="view-module" class="dropdown-trigger"></paper-icon-button>

                <paper-menu class="dropdown-content" selected="0">
                    <paper-item view="month" on-tap="changeView">
                        <iron-icon icon="view-module"></iron-icon> Month
                    </paper-item>
                    <paper-item view="agendaWeek" on-tap="changeView">
                        <iron-icon icon="view-week"></iron-icon> Week
                    </paper-item>
                    <paper-item view="agendaDay" on-tap="changeView">
                        <iron-icon icon="view-day"></iron-icon> Day
                    </paper-item>
                </paper-menu>
            </paper-menu-button>

            <paper-icon-button icon="today" on-tap="jumpToToday"></paper-icon-button>
        </div> <!-- end .actions -->

        <div id="calendar" class="card">
            <fullcalendar-calendar options="[[ options ]]"
                                   view="{{ view }}"
                                   on-view-render="setTitle"
                                   on-day-click="handleDayClick"
                                   on-event-click="handleEventClick">
            </fullcalendar-calendar>
        </div> <!-- end #calendar -->

        <paper-dialog id="dialog"
                      entry-animation="scale-up-animation"
                      exit-animation="scale-down-animation">
            <h1>{{ dialogTitle }}</h1>

            <form is="iron-form"
                  id="pca"
                  method="POST"
                  action="">

                <paper-dropdown-menu label="Project Code (PCA)">
                    <paper-listbox class="dropdown-content">
                        <template is="dom-repeat" items="{{ pca }}">
                            <paper-item>
                                {{ item.title }}
                            </paper-item>
                        </template>
                    </paper-listbox>
                </paper-dropdown-menu>

                <paper-dropdown-menu label="Start Time">
                    <paper-listbox class="dropdown-content">
                        <template is="dom-repeat" items="{{ hours }}">
                            <paper-item>{{ item.hour }}</paper-item>
                        </template>
                    </paper-listbox>
                </paper-dropdown-menu>

                <paper-dropdown-menu label="End Time">
                    <paper-listbox class="dropdown-content">
                        <template is="dom-repeat" items="{{ hours }}">
                            <paper-item>{{ item.hour }}</paper-item>
                        </template>
                    </paper-listbox>
                </paper-dropdown-menu>

                <paper-input label="Description"></paper-input>
            </form>
        </paper-dialog>
    </template>

    <script>
        Polymer({
            is: 'time-travel-calendar',

            properties: {
                calendar: {
                    type: Function,
                    value: function() {
                        return Polymer.dom(this.root).querySelector('fullcalendar-calendar');
                    }
                },
                dialogTitle: {
                    type: String,
                    value: null
                },
                options: {
                    type: Object,
                    value: {
                        header: false,
                        events: [
                            { title: '1900', start: moment() }
                        ]
                    }
                },
                pca: {
                    type: Array,
                    value: null
                },
                hours: {
                    type: Array,
                    value: null
                }
            },

            changeView: function(event) {
                var selectedView = event.target.attributes.getNamedItem('view').value;
                this.calendar.changeView(selectedView);
            },

            previous: function() { this.calendar.previous(); },

            next: function() { this.calendar.next(); },

            jumpToToday: function(event) { console.log(event); },

            handleDayClick: function(event) {
                Polymer.dom(this.root).querySelector('#dialog').open();
                this.dialogTitle = 'Add Time';
                // event.detail.date._d
            },

            handleEventClick: function(event) {
                Polymer.dom(this.root).querySelector('#dialog').open();
                this.dialogTitle = 'Edit Time';
                // event.detail.event.title
            },

            setTitle: function(event) {
                this.title = event.detail.view.title;
            },

            aquirePCA: function(pca) {
                this.pca = pca.detail.response;
            },

            aquireHours: function(hours) {
                this.hours = hours.detail.response;
            }
        });
    </script>
</dom-module>
